
import pandas

from nova.utilities.pyplot import plt

"""
Coordinate system transfer.

TGCS to MCS:
    𝑋𝑀𝐶𝑆 = 5334.4 − 𝑋𝑇𝐺𝐶𝑆
    𝑌𝑀𝐶𝑆 = 29 − 𝑍𝑇𝐺𝐶𝑆
    𝑍𝑀𝐶𝑆 = 𝑌𝑇𝐺𝐶𝑆

From MCS to TGCS:
    𝑋𝑇𝐺𝐶𝑆 = 5334.4 − 𝑋𝑀𝐶𝑆
    𝑌𝑇𝐺𝐶𝑆 = 𝑍𝑀𝐶𝑆
    𝑍𝑇𝐺𝐶𝑆 = 29 - 𝑌𝑀𝐶𝑆

"""

# CCL as-built fudicials in TGCS for TF06
TF06_coordinates = pandas.DataFrame(
    index=['A', '1-A', '1', '1-21', '1-2', '1-22', '2', 'B-2', 'B', '3', '4',
           '5', 'C', '6', '7', '8', 'D', '9', '10', '11', 'G', '12', '13',
           '14', 'E', '15', '16', '18', '19', '20'],
    columns=['x', 'y', 'z', 'dx', 'dy', 'dz'],
    data=[[2713.20, 0.64, -3671.12, -0.50, 0.64, -0.12],
          [2713.73, 0.07, -2746.08, 0.03, 0.07, -0.08],
          [2714.25, 0.02, -1820.91, 0.55, 0.02, 0.09],
          [2714.24, -0.21, -895.98, 0.54, -0.21, 0.02],
          [2714.17, -0.74, 28.95, 0.47, -0.74, -0.05],
          [2714.08, -0.88, 954.08, 0.38, -0.88, 0.08],
          [2713.92, -0.38, 1879.21, 0.22, -0.38, 0.21],
          [2713.37, 0.27, 2804.04, -0.33, 0.27, 0.04],
          [2712.80, 1.42, 3728.96, -0.90, 1.42, -0.04],
          [2919.86, 1.85, 4952.89, -1.44, 1.85, 0.79],
          [3502.79, 2.17, 5723.39, -1.21, 2.17, 1.49],
          [4354.16, 2.25, 6180.35, -0.94, 2.25, 1.65],
          [5333.36, 1.55, 6327.06, -1.04, 1.55, 1.66],
          [6365.03, 1.34, 6163.03, -1.37, 1.34, 0.73],
          [7324.21, 0.45, 5741.86, -1.89, 0.45, 0.16],
          [8202.53, -0.22, 5170.61, -2.37, -0.22, -0.19],
          [8977.45, -0.38, 4465.52, -2.95, -0.38, -0.48],
          [9722.65, -0.62, 3500.91, -3.65, -0.62, -0.69],
          [10274.49, -0.79, 2413.77, -4.41, -0.79, -0.73],
          [10613.46, -1.01, 1242.60, -4.94, -1.01, -0.60],
          [10728.31, -0.90, 28.90, -4.69, -0.90, -0.10],
          [10654.52, -0.91, -949.17, -4.78, -0.91, 0.23],
          [10435.59, -0.76, -1905.07, -4.41, -0.76, 0.33],
          [10076.40, -0.49, -2817.52, -3.70, -0.49, 0.28],
          [9584.23, 0.08, -3665.59, -3.37, 0.08, 0.41],
          [8753.28, 1.08, -4653.12, -2.22, 1.08, 0.48],
          [7744.78, 2.25, -5460.72, 0.38, 2.25, -2.42],
          [4284.62, 2.67, -6104.88, 0.12, 2.67, -0.58],
          [3399.69, 2.65, -5569.54, -0.01, 2.65, -0.54],
          [2841.96, 2.32, -4700.20, -0.44, 2.32, -0.50]])
TF06_coordinates.attrs['coordinates'] = 'TGCS'

fudicials = pandas.DataFrame(
    index=TF06_coordinates.index,
    columns=['x', 'y', 'z'])


fudicials[:] = TF06_coordinates.loc[:, 'x':'z'].values - \
    TF06_coordinates.loc[:, 'dx':'dz'].values

'''
index = ['A', 'B', 'C', 'D', 'E', 'G']
plt.plot(fudicials.x, fudicials.z, 'o')
plt.plot(fudicials.loc[index, 'x'], fudicials.loc[index, 'z'], 'o')
plt.gca().set_aspect('equal')
'''


def AUtoTGCS(MCS):
    """Convert ccl delta coordinates from AU (JA) to TGCS."""
    TGCS = pandas.DataFrame(index=MCS.index, columns=MCS.columns)
    TGCS.loc[:, 'dx'] = MCS.dz
    TGCS.loc[:, 'dy'] = MCS.dx
    TGCS.loc[:, 'dz'] = MCS.dy
    return TGCS


# TF01 - EU - pending

TF02 = AUtoTGCS(pandas.DataFrame(
    index=['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.01, -0.3, -0.71],
          [0.0, -0.41, -0.51],
          [0.31, 1.84, -0.93],
          [0.08, -1.95, -2.91],
          [-0.44, -0.79, -5.18],
          [1.06, -0.62, -2.29],
          [-1.39, -1.93, -5.96],
          [-0.96, -0.3, 0.73]]))


TF03 = pandas.DataFrame(
    index=['A', '1-A', '1', '1-21', '1-2', '1-22', '2', 'B-2', 'B',
           '3', '4', '5', 'C', '6', '7', '8', 'D', '9', '10', '11', 'G', '12',
           '13', '14', 'E', '15', '16', '18', '19', '20'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.64, -0.07, -0.25],
          [-0.46, -0.04, -0.21],
          [0.04, -0.03, -0.01],
          [0., -0.23, -0.01],
          [-0.05, -0.42, -0.01],
          [-0.14, -0.02,  0.04],
          [-0.23,  0.38,  0.08],
          [-0.55,  0.2,  0.08],
          [-0.89,  0.08,  0.01],
          [-1.33, -0.04,  0.23],
          [-1.67, -0.1,  0.65],
          [-2.01, -0.16,  1.06],
          [-2.34, -0.23,  1.43],
          [-2.53, -0.3,  1.15],
          [-2.73, -0.38,  0.86],
          [-2.92, -0.45,  0.57],
          [-3.12, -0.53,  0.29],
          [-3.33, -0.59,  0.03],
          [-3.51, -0.61,  0.01],
          [-3.68, -0.62, -0.02],
          [-3.69, -0.52, -0.15],
          [-3.62, -0.38, -0.31],
          [-3.25, -0.2, -0.48],
          [-2.82, -0.01, -0.66],
          [-2.4,  0.18, -0.83],
          [-1.98,  0.33, -1.28],
          [-1.41,  0.6, -1.68],
          [-1.11,  0.08, -0.69],
          [-1.02, -0.06, -0.41],
          [-0.85, -0.09, -0.3]])

# TF04 - EU - pending

TF05 = pandas.DataFrame(
    index=['A', '1-A', '1', '1-21', '1-2', '1-22', '2', 'B-2', 'B',
           '3', '4', '5', 'C', '6', '7', '8', 'D', '9', '10', '11', 'G', '12',
           '13', '14', 'E', '15', '16', '18', '19', '20'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.47, -0.05, -0.04],
          [-0.19, -0.13,  0.03],
          [0.22, -0.25,  0.16],
          [0.13, -0.33,  0.13],
          [0.04, -0.41,  0.1],
          [-0.05, -0.35,  0.05],
          [-0.14, -0.11,  0.],
          [-0.17,  0.04, -0.03],
          [-0.53,  0.27,  0.],
          [-1.01,  0.38,  0.28],
          [-1.39,  0.31,  0.69],
          [-1.76,  0.24,  1.1],
          [-2.14,  0.16,  1.47],
          [-2.42, -0.01,  1.24],
          [-2.71, -0.19,  1.02],
          [-2.99, -0.37,  0.8],
          [-3.28, -0.55,  0.57],
          [-3.57, -0.68,  0.33],
          [-3.75, -0.57,  0.14],
          [-3.93, -0.45, -0.06],
          [-3.59, -0.36, -0.22],
          [-3.28, -0.24, -0.38],
          [-2.98, -0.12, -0.54],
          [-2.67,  0., -0.7],
          [-2.37,  0.11, -0.85],
          [-2.04,  0.13, -1.08],
          [-1.59,  0.23, -1.45],
          [-1.17,  0.14, -0.53],
          [-1.04,  0.12, -0.27],
          [-0.79,  0.04, -0.13]])

TF06 = pandas.DataFrame(
    index=['A', '1-A', '1', '1-21', '1-2', '1-22', '2', 'B-2', 'B',
           '3', '4', '5', 'C', '6', '7', '8', 'D', '9', '10', '11', 'G', '12',
           '13', '14', 'E', '15', '16', '18', '19', '20'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.24,  0.05, -0.12],
          [0.03,  0.05, -0.08],
          [0.47, -0.01,  0.09],
          [0.38, -0.17,  0.02],
          [0.29, -0.31, -0.05],
          [0.23, -0.14, 0.08],
          [0.16,  0.04, 0.21],
          [-0.23,  0.34,  0.04],
          [-0.63,  0.36, -0.04],
          [-1.11,  0.39,  0.15],
          [-1.44,  0.42,  0.53],
          [-1.77,  0.45,  0.92],
          [-2.1,  0.47,  1.27],
          [-2.32,  0.33,  1.07],
          [-2.56,  0.19,  0.86],
          [-2.78,  0.05,  0.65],
          [-3.01, -0.1,  0.45],
          [-3.29, -0.24,  0.21],
          [-3.61, -0.32,  0.],
          [-3.92, -0.41, -0.21],
          [-3.59, -0.36, -0.1],
          [-3.55, -0.4, -0.12],
          [-3.21, -0.26, -0.37],
          [-2.82, -0.08, -0.66],
          [-2.43,  0.09, -0.96],
          [-1.73,  0.46, -1.11],
          [-1.3,  0.72, -1.46],
          [-0.92,  0.24, -0.54],
          [-0.81,  0.11, -0.28],
          [-0.55,  0.06, -0.17]])

# TF07 - JA - pending

TF08 = pandas.DataFrame(
    index=['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.69, -0.62, -0.52],
          [-0.72, -0.72, -1.08],
          [-1.19, 1.11, -0.08],
          [-2.56, 0.25, -0.3],
          [-3.17, -1.97, -0.07],
          [-1.48, -0.9, 0.21],
          [-3.17, 0.04, -0.22],
          [0.34, 0.48, -2.31]])

TF09 = pandas.DataFrame(
    index=['A', '1-A', '1', '1-21', '1-2', '1-22', '2', 'B-2', 'B',
           '3', '4', '5', 'C', '6', '7', '8', 'D', '9', '10', '11', 'G', '12',
           '13', '14', 'E', '15', '16', '18', '19', '20'],
    columns=['dx', 'dy', 'dz'],
    data=[[-0.33,  0.22, -0.12],
          [-0.15,  0.33, -0.05],
          [-0.06,  0.36,  0.01],
          [-0.03,  0.01,  0.07],
          [0.04, -0.27,  0.17],
          [-0.15, -0.16,  0.1],
          [-0.39, -0.11,  0.08],
          [-0.61, -0.15,  0.07],
          [-0.84, -0.28,  0.02],
          [-0.89, -0.23,  0.05],
          [-0.75,  0.07,  0.19],
          [-1.27,  0.44,  0.53],
          [-2.11,  0.87,  0.99],
          [-1.01,  0.38,  0.42],
          [-0.5,  0.14,  0.14],
          [-0.37,  0.07,  0.05],
          [-0.37,  0.04, -0.01],
          [-0.51,  0.03, -0.08],
          [-1.08,  0.02, -0.22],
          [-3.17,  0.02, -0.7],
          [-2.4,  0.01, -0.55],
          [-1.01,  0.01, -0.25],
          [-0.57,  0.01, -0.18],
          [-0.44,  0.01, -0.19],
          [-0.47,  0.01, -0.3],
          [-0.92,  0.01, -0.81],
          [-1.95,  0.01, -1.87],
          [-0.52,  0.18, -0.25],
          [-1.,  0.45, -0.4],
          [-0.73,  0.35, -0.29]])

def read_clipboard():
    """Read displacment data from clipboard."""
    ccl = pandas.read_clipboard(header=None)
    ccl.set_index(0, inplace=True)
    ccl.index.name = None
    columns = ccl.columns
    ccl.drop(columns=columns[3:], inplace=True)
    ccl.columns = ['dx', 'dy', 'dz']
    return ccl.dropna(0)

fudicials = fudicials.loc[['A', 'B', 'C', 'D', 'E', 'G'], :]

factor = 500

plt.plot(fudicials.x, fudicials.z, '*')

plt.plot(fudicials.x+factor*TF02.dx, fudicials.z+factor*TF02.dz, 'o')
plt.plot(fudicials.x+factor*TF08.dx, fudicials.z+factor*TF08.dz, 'o')
plt.plot(fudicials.x+factor*TF05.dx, fudicials.z+factor*TF05.dz, 'o')
plt.plot(fudicials.x+factor*TF09.dx, fudicials.z+factor*TF09.dz, 's')
plt.gca().set_aspect('equal')
